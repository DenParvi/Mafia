<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Голос Мафии</title>
    <link rel="stylesheet" href="styles_sound.css">
</head>
<body>
    <button id="backButton" onclick="window.location.href='index.html'">На главную</button>
    <div class="button-container">
        <!-- Остальные кнопки -->
        <div class="button-row">
            <span class="music-title">Таймер</span>
            <div class="button-column">
                <button class="button" onclick="startTimerWithSounds(30)">30</button>
                <button class="button" onclick="startTimerWithSounds(60)">60</button>
            </div>
        </div>
    </div>

    <div class="control-buttons">
        <button class="control-button" onclick="startAudio()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M8 5v14l11-7z"/>
            </svg>
        </button>
        <button class="control-button" onclick="pauseAudio()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M6 4h4v16H6zm8 0h4v16h-4z"/>
            </svg>
        </button>
        <button class="control-button" onclick="resetAudio()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M6 6h12v12H6z"/>
            </svg>
        </button>
    </div>

    <div class="timer" id="timer-display">00:00</div>
    <div class="timer" id="sound-timer-display">00:00</div>

    <audio id="audio-player" controls style="display:none;"></audio>

    <script>
        let audio = document.getElementById('audio-player');
        let timerInterval;
        let timerIntervalSound;
        let currentButton;
        let timerDisplay = document.getElementById('timer-display');
        let soundTimerDisplay = document.getElementById('sound-timer-display');

        function playAudio(button, file) {
            if (currentButton) {
                currentButton.classList.remove('active');
                currentButton.style.backgroundColor = '#6200ea';
            }

            currentButton = button;
            currentButton.classList.add('active');
            currentButton.style.backgroundColor = 'green';

            if (audio.src !== file) {
                audio.src = file;
                audio.load();
                audio.oncanplaythrough = function() { 
                    audio.play();
                    resetTimer();
                    startTimer();
                };
            } else if (audio.paused) {
                audio.play();
                startTimer();
            }

            audio.onended = function() {
                currentButton.classList.remove('active');
                currentButton.style.backgroundColor = '#6200ea';
            };
        }

        function pauseAudio() {
            audio.pause();
            clearInterval(timerInterval);
        }

        function startAudio() {
            if (audio.paused) {
                audio.play();
                startTimer();
            }
        }

        function resetAudio() {
            audio.pause();
            audio.currentTime = 0;
            clearInterval(timerInterval);
            updateTimerDisplay('00:00');
            audio.oncanplaythrough = null;
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                let minutes = Math.floor(audio.currentTime / 60);
                let seconds = Math.floor(audio.currentTime % 60);
                let timeString = minutes.toString().padStart(2, '0') + ':' + seconds.toString().padStart(2, '0');
                updateTimerDisplay(timeString);
            }, 1000);
        }

        function resetTimer() {
            clearInterval(timerInterval);
            updateTimerDisplay('00:00');
        }

        function updateTimerDisplay(time) {
            timerDisplay.textContent = time;
        }

        function startTimerWithSounds(time) {
            clearInterval(timerIntervalSound);
            let timeLeft = time;
            updateSoundTimerDisplay(timeLeft);

            timerIntervalSound = setInterval(() => {
                timeLeft--;
                updateSoundTimerDisplay(timeLeft);

                if (timeLeft === 11) {
                    playAudioFile('audio/10 секунд.mp3'); 
                } else if (timeLeft === 0) {
                    clearInterval(timerIntervalSound);
                    playAudioFile('audio/время.mp3'); 
                }
            }, 1000);
        }

        function updateSoundTimerDisplay(time) {
            soundTimerDisplay.textContent = `Таймер: ${time}`;
        }

        function playAudioFile(file) {
            audio.src = file;
            audio.load();
            audio.play();
        }
    </script>
</body>
</html>
